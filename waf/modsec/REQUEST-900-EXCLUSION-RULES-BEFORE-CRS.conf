# REQUEST-900-EXCLUSION-RULES-BEFORE-CRS.conf
#
# Targeted Google OAuth callback exclusions (only for these endpoints)
# Tweak the regex to your actual routes.
SecRule REQUEST_URI "@rx ^/(auth/google/callback|oauth2callback|api/auth/callback/google)$" \
    "id:1000001,\
    phase:1,\
    pass,\
    nolog,\
    t:none,\
    ctl:ruleRemoveById=941100,941110,941120,941130, \
                       942100,942110,942120,942130,942200,942260,942340,942430,942450, \
                       920273"

# Optional: if you POST a large JWT (e.g. GIS 'credential' or OIDC 'id_token'),
# skip XSS/SQLi checks on those specific fields for these paths instead of
# removing whole rule families above. Comment out block above if you prefer this narrower approach.
# SecRule REQUEST_URI "@rx ^/(auth/google/callback|oauth2callback|api/auth/callback/google)$" \
#     "id:1000002,phase:1,pass,nolog,t:none,\
#      ctl:ruleRemoveTargetById=941100;ARGS:state,\
#      ctl:ruleRemoveTargetById=942100;ARGS:state,\
#      ctl:ruleRemoveTargetById=941100;ARGS:code,\
#      ctl:ruleRemoveTargetById=942100;ARGS:code,\
#      ctl:ruleRemoveTargetById=941100;ARGS:credential,\
#      ctl:ruleRemoveTargetById=942100;ARGS:credential,\
#      ctl:ruleRemoveTargetById=941100;ARGS:id_token,\
#      ctl:ruleRemoveTargetById=942100;ARGS:id_token"
